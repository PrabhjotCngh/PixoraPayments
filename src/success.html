<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Successful</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="success-screen" style="background-image: url('../assets/payment_background.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
  <div class="container">
    <div class="success-icon">
      <svg width="100" height="100" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" fill="#099f6c" />
        <path d="M30 50 L45 65 L70 35" stroke="white" stroke-width="8" fill="none" stroke-linecap="round" />
      </svg>
    </div>
    
    <h1 class="title success-title">Payment Successful!</h1>
    <p class="message">Thank you for your payment. Launching photobooth...</p>
    
    <div class="countdown">
      <span id="countdown">3</span>
    </div>
  </div>

  <script>
    window.addEventListener('error', (e) => {
      console.error('Uncaught error in success.html:', e);
    });
    window.addEventListener('unhandledrejection', (e) => {
      console.error('Unhandled rejection in success.html:', e);
    });
    let countdown = 3;
    
    window.addEventListener('DOMContentLoaded', async () => {
      const config = await window.electronAPI.getConfig();
      const duration = config.screens.successDuration / 1000;
      countdown = duration;
      
      document.getElementById('countdown').textContent = countdown;
      
      const interval = setInterval(() => {
        countdown--;
        document.getElementById('countdown').textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(interval);
          launchOrRestorePhotobooth();
        }
      }, 1000);
    });

    async function launchOrRestorePhotobooth() {
      // App will close automatically after launching photobooth
        console.log('Attempting restoreOrLaunchPhotobooth...');
        try {
          const result = await window.electronAPI.restoreOrLaunchPhotobooth();
          console.log('restoreOrLaunchPhotobooth result:', result);
          if (!result.success) {
            alert('Failed to launch photobooth: ' + result.error);
            window.location.href = 'index.html';
          }
        } catch (e) {
          console.error('Error calling restoreOrLaunchPhotobooth:', e);
          window.location.href = 'index.html';
        }
    }
  </script>
</body>
</html>