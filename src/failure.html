<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Failed</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="failure-screen" style="background-image: url('../assets/payment_background.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
  <div class="progress-bar-container">
    <div id="progress-bar" class="progress-bar"></div>
  </div>
  <div class="container">
    <div class="failure-icon">
      <svg width="100" height="100" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" fill="#f36c21" />
        <path d="M35 35 L65 65 M65 35 L35 65" stroke="white" stroke-width="8" stroke-linecap="round" />
      </svg>
    </div>
    
    <h1 class="title failure-title">Payment Failed</h1>
    <p id="failure-reason" class="message">Your payment could not be completed. Please try again.</p>
    
    <div class="button-group">
      <button id="retry-btn" class="btn btn-primary">Retry Payment</button>
    </div>
    
    <div class="countdown-text">
      Returning to home in <span id="countdown">5</span> seconds...
    </div>
  </div>

  <script>
    let countdown = 5;
    let autoRedirectTimer = null;
    
    window.addEventListener('DOMContentLoaded', async () => {
      const config = await window.electronAPI.getConfig();
      const duration = config.screens.failureDuration / 1000;
      countdown = duration;
      
      // Check for failure reason in URL
      const params = new URLSearchParams(window.location.search);
      const reason = params.get('reason');
      
      if (reason === 'expired') {
        document.getElementById('failure-reason').textContent = 
          'QR code expired. Please try again.';
      }
      
      // Start countdown
      document.getElementById('countdown').textContent = countdown;
      startCountdown();
      
      // Button handlers
      document.getElementById('retry-btn').addEventListener('click', () => {
        clearTimeout(autoRedirectTimer);
        window.location.href = 'payment.html';
      });
      
    });

    function startCountdown() {
      const totalDuration = countdown;
      const progressBar = document.getElementById('progress-bar');
      
      // Animate progress bar from 100% to 0% as timer runs out
      setTimeout(() => {
        progressBar.style.transition = `width ${totalDuration}s linear`;
        progressBar.style.width = '0%';
      }, 50);
      
      const interval = setInterval(async () => {
        countdown--;
        document.getElementById('countdown').textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(interval);
          try { await window.electronAPI.launchPhotobooth(); } catch (e) {}
        }
      }, 1000);
    }
  </script>
</body>
</html>